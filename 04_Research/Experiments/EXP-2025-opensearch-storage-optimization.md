# EXP-2025 — Оптимизация хранения в OpenSearch

## Контекст

- Платформа Sage Observability в T-Bank.  
- Логи и метрики → десятки петабайт данных.  
- Стоит задача уменьшить объём хранилища без потери функциональности поиска.

## Гипотеза

Комбинация:

- сортировки индексов (`index.sort.field = @timestamp` или `inst + @timestamp`),  
- `_forcemerge` до 1 сегмента на shard,  
- отказа от поля `all` и `copy_to: "all"`  

должна давать заметную экономию места и лучшее поведение поиска.

## План эксперимента (черновой)

1. Взять репрезентативные группы индексов (разный объём, разная однородность данных).  
2. Сделать копии индексов с разными сценариями (чистая копия, только sort, sort+forcemerge, без `all`).  
3. Измерить:
   - объём на диске;  
   - latency поиска;  
   - скорость индексации;  
   - нагрузку на кластер при операциях sort/forcemerge.  
4. Сравнить и зафиксировать выигрыш/проигрыш по каждому сценарию.  
5. Оформить выводы в документ и связать с потенциальной экономией денег.

## Метрики

- Объём на диске (GB/TB, относительная экономия в %).  
- Latency поиска (P50/P95/P99).  
- Скорость индексации (документов в секунду).  
- Нагрузка на кластер во время операций sort/forcemerge.

## Результаты (кратко, заполнить)

- На некоторых группах уже есть наблюдение экономии до ~37% места.  
- Сильный эффект в группах с высокой однородностью и без ранее применённого forcemerge.  
- …

## Выводы и решения (заполнять по мере эксперимента)

- Где сортировка реально окупается.  
- Для каких групп индексов достаточно forcemerge.  
- Где отказ от `all` даёт существенную экономию.

## Связано

- [[02_Projects/sage_observability/README|Sage Observability]]
- [[03_Work & Career/T-Bank SRE/Overview|T-Bank SRE — роль]]
- [[01_Knowledge/SRE & Observability/Index|SRE & Observability — Index]]

- [[04_Research/Ideas/IDEA-mlops-logs-analyzer|IDEA — MLOps для анализа логов]]
- [[04_Research/Papers/PaperRoadmap-A-level-mlops|Roadmap A-level статьи по MLOps]]
